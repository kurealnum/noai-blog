import{t as x,j as e,a0 as L,c as E,r as p,b2 as N,e as C,b3 as M,C as T,b4 as D,a3 as I,s as A,L as q,b as _,b5 as B,aF as O,b6 as w,b7 as k,b8 as V,b9 as J}from"./index-DLaIVEUD.js";import{p as u}from"./purify.es-Bq0E5Q3l.js";import{r as K,i as Q}from"./createSvgIcon-DUBVtWZV.js";import{P as G,d as U}from"./Profile-C5plvNdK.js";import{C as y}from"./Comment-BcdCYmSP.js";import{M as $,m as W,H as P}from"./index-BUBKL0Cg.js";const X=x(e.jsx("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite"),Y=x(e.jsx("path",{d:"M7 15v2h10v-2zm-4 6h18v-2H3zm0-8h18v-2H3zm4-6v2h10V7zM3 3v2h18V3z"}),"FormatAlignCenter"),Z=x(e.jsx("path",{d:"M15 15H3v2h12zm0-8H3v2h12zM3 13h18v-2H3zm0 8h18v-2H3zM3 3v2h18V3z"}),"FormatAlignLeft");var j={},ee=Q;Object.defineProperty(j,"__esModule",{value:!0});var z=j.default=void 0,te=ee(K()),se=e;z=j.default=(0,te.default)((0,se.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder");function ae({raw:r,refetch:a}){const d=new Set([]);function c(t,s){return t.map(i=>{if(l[i]!=null&&d.has(i)==!1){const f=e.jsxs(e.Fragment,{children:[e.jsx(y,{content:n[i],isReply:s>1,id:n[i].id,refetch:a}),c(Object.keys(l[i]),s+1)]});return d.add(i),f}return d.has(i)==!0?null:e.jsx(y,{content:n[i],isReply:s>1,refetch:a},n[i].id)})}const n={};r.forEach(t=>{n[t.id]=t});const l={},h=new Set([]);return r.forEach(t=>{t.reply_to!=null&&(l[t.reply_to.id]={...l[t.reply_to.id],[t.id]:null},h.add(t.id),h.add(t.reply_to.id))}),r.forEach(t=>{h.has(t.id)==!1&&(l[t.id]={})}),e.jsx("ul",{className:"list",children:c(Object.keys(l),1)},1)}const re=new $(W({langPrefix:"hljs language-",highlight(r,a,d){const c=P.getLanguage(a)?a:"plaintext";return P.highlight(r,{language:c}).value}}));function ue(){const{username:r,slug:a}=L(),d=E("root"),[c,n]=p.useState(!1),[l,h]=p.useState(!1),t=N(),{data:s,isLoading:v,isSuccess:i,isError:f,error:S,refetch:b}=C({queryKey:["getPost_"+t,r,a],queryFn:()=>O(r,a)}),m=C({queryKey:["getCommentsByPost_"+t,r,a],queryFn:()=>w(r,a)});p.useEffect(()=>{M(a,r).then(o=>{n(!!o)})},[a,r,t]);function F(){k(a,r,t).then(o=>{o?(n(!0),b()):n(!1)})}function H(){V(a,t).then(o=>{o?(n(!1),b()):n(!0)})}function R(o){o.preventDefault(),J(r,a,o.target[0].value,"").then(g=>{g&&(m.refetch(),o.target[0].value="")})}if(v)return e.jsx("div",{id:"blog-post",className:"centered-page",children:e.jsx(T,{sx:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0",margin:"auto"}})});if(f)return e.jsx("div",{id:"error-page",children:e.jsx("h1",{children:S.message})});if(i){document.title=document.title+" - "+s.title;const o={"@context":"https://schema.org","@type":"NewsArticle",headline:u.sanitize(s.title),image:[s.thumbnail],datePublished:u.sanitize(s.created_date),dateModified:u.sanitize(s.updated_date),author:[{"@type":"Person",name:u.sanitize(s.user.username),url:"/homepage/"+u.sanitize(s.user.username)}]};return e.jsxs(e.Fragment,{children:[e.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(o)}}),e.jsxs("div",{id:"blog-post",children:[e.jsx("div",{className:"blogpost-thumbnail-wrapper",children:e.jsx(D,{url:s.thumbnail})}),e.jsx("h1",{children:s.title}),e.jsxs("div",{className:"info-bar",children:[e.jsx("div",{className:"info-bar-box",children:e.jsx(G,{content:s})}),e.jsx("button",{className:"reaction-button","data-testid":"reaction-button-icon",onClick:c?()=>H():()=>F(),children:e.jsxs("div",{className:"likes",children:[e.jsx("span",{"data-testid":"reaction-count",children:s.likes==null?0:s.likes}),c?e.jsx(X,{}):e.jsx(z,{})]})}),e.jsxs("div",{id:"member-since",children:[e.jsx(U,{}),e.jsx("span",{children:s.created_date.replace(/(T.*)/g,"")})]}),e.jsx("button",{className:"reaction-button",onClick:()=>h(!l),children:l?e.jsx(Y,{}):e.jsx(Z,{})}),e.jsx(I,{type:"post",isFlaggedParam:s.flagged,content:{username:s.user.username,slug:A(s.title)}}),d.username===r?e.jsx(q,{className:"text-box",to:t==="list"?_("f_EDIT_LIST",[t,a]):_("f_EDIT_BLOG_POST",["blog-post",a]),children:e.jsx("p",{children:"Edit"})}):null]}),e.jsx("div",{className:l?"blog-post-content-align-left":"blog-post-content-align-center",dangerouslySetInnerHTML:{__html:u.sanitize(re.parse(s.content))}}),e.jsxs("div",{children:[e.jsx("h2",{children:"Comments"}),B()?e.jsxs("form",{onSubmit:g=>R(g),className:"create-comment-form",children:[e.jsx("textarea",{}),e.jsx("button",{type:"submit",children:"Comment"})]}):null,m.isSuccess?e.jsx(ae,{raw:m.data,refetch:m.refetch}):e.jsx("h3",{children:"There was an error fetching the comments!"})]})]})]})}}export{ue as P};
