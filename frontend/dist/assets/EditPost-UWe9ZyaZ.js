import{c as y,a0 as E,r as l,ad as _,ae as m,as as w,T as N,e as B,aF as C,p as H,j as t,N as c,C as L,b as g,s as p,aG as M}from"./index-DLaIVEUD.js";import{S as O}from"./atom-one-dark-gXW4YYr5.js";import{p as F}from"./purify.es-Bq0E5Q3l.js";import{M as G,m as R,H as h}from"./index-BUBKL0Cg.js";const k=new G(R({langPrefix:"hljs language-",highlight(i,a,r){const s=h.getLanguage(a)?a:"plaintext";return h.highlight(i,{language:s}).value}}));function Y(){const i=y("root"),{type:a,slug:r}=E(),[s,u]=l.useState({}),[f,x]=l.useState({}),d=_();a==="list"?d(m(w)):a==="blog-post"&&d(m(N));const n=B({queryFn:()=>C(i.username,r),queryKey:["toEditBlogPost",{username:i.username,slug:r,type:a}],retry:!1}),o=H({mutationFn:M});l.useEffect(()=>{n.isSuccess&&u({...n.data,slug:r})},[r,n.data,n.isSuccess]);const b=1e3,j=l.useMemo(()=>({autosave:{enabled:!0,uniqueId:"autosaveeditedpost",delay:b},previewRender(e){return F.sanitize(k.parse(e))}}),[]);function P(e){e.preventDefault(),o.mutate({newBlogPost:s,thumbnail:f,originalSlug:r})}function T(e){u({...s,content:e})}function S(e){u({...s,[e.target.name]:e.target.value})}function v(e){x({[e.target.name]:e.target.files[0]})}if(n.isError)return t.jsx(c,{to:"/dashboard/"});if(n.isPending,o.isPending)return t.jsx(L,{sx:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0",margin:"auto"}});if(o.isSuccess){let e;return a==="list"?e=g("f_GET_LIST",[i.username,p(s.title)]):a==="blog-post"&&(e=g("f_GET_BLOG_POST",[i.username,p(s.title)])),t.jsx(c,{to:e})}return t.jsxs("div",{id:"create-post",children:[t.jsxs("form",{className:"post-form","aria-label":"Image and title input",encType:"multipart/form-data",method:"POST",onSubmit:e=>P(e),children:[t.jsxs("div",{className:"flex-row-spacing",children:[t.jsx("label",{htmlFor:"thumbnail",hidden:!0,children:"Thumbnail"}),t.jsx("input",{id:"thumbnail",name:"thumbnail",type:"file",accept:"image/png, image/jpeg",onChange:e=>v(e)}),t.jsx("label",{htmlFor:"title",hidden:!0,children:"Title"}),t.jsx("input",{id:"title",name:"title",onChange:e=>S(e),defaultValue:s.title})]}),t.jsx("div",{className:"simplemde-wrapper",children:t.jsx(O,{options:j,onChange:T,value:s.content})}),t.jsx("button",{"data-testid":"submit-button",className:"save-button",type:"submit",children:"Save"})]}),o.isError?t.jsxs("div",{id:"error-page",children:[t.jsx("h1",{children:"There was an error!"}),t.jsx("p",{children:o.error.message})]}):null]})}export{Y as default};
