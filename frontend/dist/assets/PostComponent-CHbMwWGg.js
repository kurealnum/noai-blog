import{v as E,j as e,a1 as T,c as F,r as j,b2 as H,e as b,b3 as L,C as z,a3 as D,s as I,L as v,b as y,b4 as q,aG as B,b5 as M,b6 as O,b7 as w,b8 as k}from"./index-BX5Plg-3.js";import{p as c}from"./purify.es-Bq0E5Q3l.js";import{r as A,i as G}from"./createSvgIcon-BZpKwsu1.js";import{P as J,d as K}from"./Profile-181XEs0i.js";import{C as _}from"./Comment-tZ4AOBwC.js";import{M as Q,m as U,H as C}from"./index-ByFTUCV5.js";const Y=E(e.jsx("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite");var g={},$=G;Object.defineProperty(g,"__esModule",{value:!0});var P=g.default=void 0,V=$(A()),W=e;P=g.default=(0,V.default)((0,W.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder");function X({raw:r,refetch:s}){const u=new Set([]);function d(a,h){return a.map(o=>{if(i[o]!=null&&u.has(o)==!1){const m=e.jsxs(e.Fragment,{children:[e.jsx(_,{content:n[o],isReply:h>1,id:n[o].id,refetch:s}),d(Object.keys(i[o]),h+1)]});return u.add(o),m}return u.has(o)==!0?null:e.jsx(_,{content:n[o],isReply:h>1,refetch:s},n[o].id)})}const n={};r.forEach(a=>{n[a.id]=a});const i={},t=new Set([]);return r.forEach(a=>{a.reply_to!=null&&(i[a.reply_to.id]={...i[a.reply_to.id],[a.id]:null},t.add(a.id),t.add(a.reply_to.id))}),r.forEach(a=>{t.has(a.id)==!1&&(i[a.id]={})}),e.jsx("ul",{className:"list",children:d(Object.keys(i),1)},1)}const Z=new Q(U({langPrefix:"hljs language-",highlight(r,s,u){const d=C.getLanguage(s)?s:"plaintext";return C.highlight(r,{language:d}).value}}));function ne(){const{username:r,slug:s}=T(),u=F("root"),[d,n]=j.useState(!1),i=H(),{data:t,isLoading:a,isSuccess:h,isError:x,error:o,refetch:m}=b({queryKey:["getPost_"+i,r,s],queryFn:()=>B(r,s)}),p=b({queryKey:["getCommentsByPost_"+i,r,s],queryFn:()=>M(r,s)});j.useEffect(()=>{L(s,r).then(l=>{n(!!l)})},[s,r,i]);function R(){O(s,r,i).then(l=>{l?(n(!0),m()):n(!1)})}function S(){w(s,i).then(l=>{l?(n(!1),m()):n(!0)})}function N(l){l.preventDefault(),k(r,s,l.target[0].value,"").then(f=>{f&&(p.refetch(),l.target[0].value="")})}if(a)return e.jsx("div",{id:"blog-post",className:"centered-page",children:e.jsx(z,{sx:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0",margin:"auto"}})});if(x)return e.jsx("div",{id:"error-page",children:e.jsx("h1",{children:o.message})});if(h){document.title="byeAI | Post - "+t.title;const l={"@context":"https://schema.org","@type":"NewsArticle",headline:c.sanitize(t.title),image:[t.thumbnail],datePublished:c.sanitize(t.created_date),dateModified:c.sanitize(t.updated_date),author:[{"@type":"Person",name:c.sanitize(t.user.username),url:"/homepage/"+c.sanitize(t.user.username)}]};return e.jsxs(e.Fragment,{children:[e.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(l)}}),e.jsxs("div",{id:"blog-post",className:"text-based-page",children:[e.jsx("h1",{children:t.title}),e.jsxs("div",{className:"info-bar",children:[e.jsx("div",{className:"info-bar-box",children:e.jsx(J,{content:t})}),e.jsx("button",{className:"reaction-button","data-testid":"reaction-button-icon",onClick:d?()=>S():()=>R(),children:e.jsxs("div",{className:"likes",children:[e.jsx("span",{"data-testid":"reaction-count",children:t.likes==null?0:t.likes}),d?e.jsx(Y,{}):e.jsx(P,{})]})}),e.jsxs("div",{id:"member-since",children:[e.jsx(K,{}),e.jsx("span",{children:t.created_date.replace(/(T.*)/g,"")})]}),e.jsx(D,{type:"post",isFlaggedParam:t.flagged,content:{username:t.user.username,slug:I(t.title)}}),u.username===r?e.jsx(v,{className:"text-box",to:i==="list"?y("f_EDIT_LIST",[i,s]):y("f_EDIT_BLOG_POST",["blog-post",s]),children:e.jsx("p",{children:"Edit"})}):null]}),t.crosspost!=null?e.jsxs("div",{className:"crosspost",children:[e.jsx("button",{children:e.jsx(v,{to:c.sanitize(t.crosspost.url),children:"Read the article"})}),e.jsxs("p",{children:["Hey! You! This is a crosspost! This button will take you to"," ",c.sanitize(t.crosspost.url),"."]})]}):null,e.jsx("div",{className:"blog-post-content-align-left",dangerouslySetInnerHTML:{__html:c.sanitize(Z.parse(t.content))}}),e.jsxs("div",{className:"comments",children:[e.jsx("h2",{children:"Comments"}),q()?e.jsxs("form",{onSubmit:f=>N(f),className:"create-comment-form",children:[e.jsx("textarea",{}),e.jsx("button",{type:"submit",children:"Comment"})]}):null,p.isSuccess?e.jsx(X,{raw:p.data,refetch:p.refetch}):e.jsx("h3",{children:"There was an error fetching the comments!"})]})]})]})}}export{ne as P};
