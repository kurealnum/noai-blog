import{j as e,E as R,x as S,r as g,V as N,C as E,s as L,L as M,W as B,X as A,Y as q,Z as D,$ as I,a0 as T}from"./index-BeUNFAff.js";import{r as w,i as O}from"./createSvgIcon-DWnuzTKb.js";import{d as V}from"./CalendarMonth-DBqL_oGL.js";import{u as C}from"./useQuery-DF7iaQ5a.js";import{p as d}from"./purify.es-Bq0E5Q3l.js";import{M as k,m as J,H as y}from"./index-BDF-iQUx.js";import{C as _}from"./Comment-CLzXbC5s.js";import{P as K}from"./Profile-B_y4T5xU.js";import{F as Q}from"./FlagButton-ghOGfcda.js";import{T as $}from"./Thumbnail-5TvQ0-iS.js";import{c as x}from"./createSvgIcon-BuhX_vZg.js";import"./useId-CVjNXGpa.js";import"./useForkRef-BsPCRZOl.js";import"./suspense-US5OwXsH.js";import"./utils-km2FGkQ4.js";import"./Close-Da5akRZq.js";import"./Delete-CEWg8pCZ.js";import"./Dialog-DnFiJzH4.js";import"./utils-M2d1AFFH.js";import"./useSlot-b_M0aM21.js";import"./Fade-DjRqLJJx.js";import"./Edit-BE1yjn6A.js";const W=x(e.jsx("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite"),X=x(e.jsx("path",{d:"M7 15v2h10v-2zm-4 6h18v-2H3zm0-8h18v-2H3zm4-6v2h10V7zM3 3v2h18V3z"}),"FormatAlignCenter"),Y=x(e.jsx("path",{d:"M15 15H3v2h12zm0-8H3v2h12zM3 13h18v-2H3zm0 8h18v-2H3zM3 3v2h18V3z"}),"FormatAlignLeft");var j={},Z=O;Object.defineProperty(j,"__esModule",{value:!0});var z=j.default=void 0,G=Z(w()),U=e;z=j.default=(0,G.default)((0,U.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder");function ee({raw:r,refetch:s}){const c=new Set([]);function l(t,m){return t.map(i=>{if(o[i]!=null&&c.has(i)==!1){const p=e.jsxs(e.Fragment,{children:[e.jsx(_,{content:a[i],isReply:m>1,refetch:s},a[i].id),l(Object.keys(o[i]),m+1)]});return c.add(i),p}return c.has(i)==!0?null:e.jsx(_,{content:a[i],isReply:m>1,refetch:s},a[i].id)})}const a={};r.forEach(t=>{a[t.id]=t});const o={},u=new Set([]);return r.forEach(t=>{t.reply_to!=null&&(o[t.reply_to.id]={...o[t.reply_to.id],[t.id]:null},u.add(t.id),u.add(t.reply_to.id))}),r.forEach(t=>{u.has(t.id)==!1&&(o[t.id]={})}),e.jsx("ul",{className:"list",children:l(Object.keys(o),1)},1)}const te=new k(J({langPrefix:"hljs language-",highlight(r,s,c){const l=y.getLanguage(s)?s:"plaintext";return y.highlight(r,{language:l}).value}}));function ze(){const{username:r,slug:s}=R(),c=S("root"),[l,a]=g.useState(!1),[o,u]=g.useState(!1),{data:t,isLoading:m,isSuccess:v,isError:i,error:p,refetch:b}=C({queryKey:["getBlogPost",r,s],queryFn:()=>I({username:r,slug:s})}),h=C({queryKey:["getCommentsByPost",s],queryFn:()=>T(r,s)});g.useEffect(()=>{N(s,r).then(n=>{a(!!n)})},[s,r]);function F(){A(s,r).then(n=>{n?(a(!0),b()):a(!1)})}function H(){q(s).then(n=>{n?(a(!1),b()):a(!0)})}function P(n){n.preventDefault(),D(s,n.target[0].value).then(f=>{f&&(h.refetch(),n.target[0].value="")})}if(m)return e.jsxs("div",{id:"blog-post",className:"centered-page",children:[e.jsx(E,{sx:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0",margin:"auto"}}),";"]});if(i)return e.jsx("div",{id:"error-page",children:e.jsx("h1",{children:p.message})});if(v){document.title=document.title+" - "+t.title;const n={"@context":"https://schema.org","@type":"NewsArticle",headline:d.sanitize(t.title),image:[t.thumbnail],datePublished:d.sanitize(t.created_date),dateModified:d.sanitize(t.updated_date),author:[{"@type":"Person",name:d.sanitize(t.user.username),url:"/homepage/"+d.sanitize(t.user.username)}]};return e.jsxs(e.Fragment,{children:[e.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(n)}}),e.jsxs("div",{id:"blog-post",children:[e.jsx("div",{className:"blogpost-thumbnail-wrapper",children:e.jsx($,{url:t.thumbnail})}),e.jsx("h1",{children:t.title}),e.jsxs("div",{className:"info-bar",children:[e.jsx("div",{className:"info-bar-box",children:e.jsx(K,{content:t})}),e.jsx("button",{className:"reaction-button","data-testid":"reaction-button-icon",onClick:l?()=>H():()=>F(),children:e.jsxs("div",{className:"likes",children:[e.jsx("span",{"data-testid":"reaction-count",children:t.likes==null?0:t.likes}),l?e.jsx(W,{}):e.jsx(z,{})]})}),e.jsxs("div",{id:"member-since",children:[e.jsx(V,{}),e.jsx("span",{children:t.created_date.replace(/(T.*)/g,"")})]}),e.jsx("button",{className:"reaction-button",onClick:()=>u(!o),children:o?e.jsx(X,{}):e.jsx(Y,{})}),e.jsx(Q,{type:"post",isFlaggedParam:t.flagged,content:{username:t.user.username,slug:L(t.title)}}),c.username===r?e.jsx(M,{className:"text-box",to:"/edit-post/"+s,children:e.jsx("p",{children:"Edit"})}):null]}),e.jsx("div",{className:o?"blog-post-content-align-left":"blog-post-content-align-center",dangerouslySetInnerHTML:{__html:d.sanitize(te.parse(t.content))}}),e.jsxs("div",{children:[e.jsx("h2",{children:"Comments"}),B()?e.jsxs("form",{onSubmit:f=>P(f),className:"create-comment-form",children:[e.jsx("textarea",{}),e.jsx("button",{type:"submit",children:"Comment"})]}):null,h.isSuccess?e.jsx(ee,{raw:h.data,refetch:h.refetch}):e.jsx("h3",{children:"There was an error fetching the comments!"})]})]})]})}}export{ze as default};
