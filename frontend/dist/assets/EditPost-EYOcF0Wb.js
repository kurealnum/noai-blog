import{x as j,E as v,r as u,$ as P,j as t,N as l,C as S,s as y,a6 as E}from"./index-YEr_JHM6.js";import{S as T}from"./atom-one-dark-DmVJwSK6.js";import{u as w}from"./useQuery-D_T9lssf.js";import{u as N}from"./useMutation-DHSfzD65.js";import{p as C}from"./purify.es-Bq0E5Q3l.js";import{M as H,m as M,H as m}from"./index-D8vnJPD0.js";import"./suspense-CmSZ0WD5.js";import"./utils-km2FGkQ4.js";const B=new H(M({langPrefix:"hljs language-",highlight(r,s,a){const n=m.getLanguage(s)?s:"plaintext";return m.highlight(r,{language:n}).value}}));function Q(){const r=j("root"),{slug:s}=v(),[a,n]=u.useState({}),[d,c]=u.useState({}),i=w({queryFn:()=>P({username:r.username,slug:s}),queryKey:["toEditBlogPost",{username:r.username,slug:s}],retry:!1}),o=N({mutationFn:E});u.useEffect(()=>{i.isSuccess&&n({...i.data,slug:s})},[s,i.data,i.isSuccess]);const g=1e3,p=u.useMemo(()=>({autosave:{enabled:!0,uniqueId:"autosaveeditedpost",delay:g},previewRender(e){return C.sanitize(B.parse(e))}}),[]);function h(e){e.preventDefault(),o.mutate({newBlogPost:a,thumbnail:d,originalSlug:s})}function f(e){n({...a,content:e})}function x(e){n({...a,[e.target.name]:e.target.value})}function b(e){c({[e.target.name]:e.target.files[0]})}return i.isError?t.jsx(l,{to:"/dashboard/"}):(i.isPending,o.isPending?t.jsx(S,{sx:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0",margin:"auto"}}):o.isSuccess?t.jsx(l,{to:"/post/"+r.username+"/"+y(a.title)}):t.jsxs("div",{id:"create-post",children:[t.jsxs("form",{className:"post-form","aria-label":"Image and title input",encType:"multipart/form-data",method:"POST",onSubmit:e=>h(e),children:[t.jsxs("div",{className:"flex-row-spacing",children:[t.jsx("label",{htmlFor:"thumbnail",hidden:!0,children:"Thumbnail"}),t.jsx("input",{id:"thumbnail",name:"thumbnail",type:"file",accept:"image/png, image/jpeg",onChange:e=>b(e)}),t.jsx("label",{htmlFor:"title",hidden:!0,children:"Title"}),t.jsx("input",{id:"title",name:"title",onChange:e=>x(e),defaultValue:a.title})]}),t.jsx("div",{className:"simplemde-wrapper",children:t.jsx(T,{options:p,onChange:f,value:a.content})}),t.jsx("button",{"data-testid":"submit-button",className:"save-button",type:"submit",children:"Save"})]}),o.isError?t.jsxs("div",{id:"error-page",children:[t.jsx("h1",{children:"There was an error!"}),t.jsx("p",{children:o.error.message})]}):null]}))}export{Q as default};
