import{v as T,j as e,u as H,b3 as P,L as g,a2 as L,c as F,r as b,b4 as z,e as v,b5 as D,C as I,a4 as q,s as B,b as y,aH as M,b6 as O,b7 as w,b8 as k,b9 as A}from"./index-DvV6ITee.js";import{p as d}from"./purify.es-Bq0E5Q3l.js";import{r as J,i as K}from"./createSvgIcon-D-HqmE07.js";import{P as Q,d as G}from"./Profile-DXTwROmf.js";import{C as _}from"./Comment-CW3zpfFv.js";import{M as U,m as Y,H as C}from"./index-uqbNbgOS.js";const $=T(e.jsx("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite");var x={},V=K;Object.defineProperty(x,"__esModule",{value:!0});var S=x.default=void 0,W=V(J()),X=e;S=x.default=(0,W.default)((0,X.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder");function Z({raw:a,refetch:s}){const p=H();if(a.length==0)return P()?null:e.jsx("ul",{className:"list",children:e.jsxs("p",{children:[e.jsx(g,{to:"/login",state:{redirectTo:p},children:"Sign up"})," ","and be the first to comment!"]})});const c=new Set([]);function l(r,m){return r.map(n=>{if(t[n]!=null&&c.has(n)==!1){const u=e.jsxs(e.Fragment,{children:[e.jsx(_,{content:i[n],isReply:m>1,id:i[n].id,refetch:s}),l(Object.keys(t[n]),m+1)]});return c.add(n),u}return c.has(n)==!0?null:e.jsx(_,{content:i[n],isReply:m>1,refetch:s},i[n].id)})}const i={};a.forEach(r=>{i[r.id]=r});const t={},h=new Set([]);return a.forEach(r=>{r.reply_to!=null&&(t[r.reply_to.id]={...t[r.reply_to.id],[r.id]:null},h.add(r.id),h.add(r.reply_to.id))}),a.forEach(r=>{h.has(r.id)==!1&&(t[r.id]={})}),e.jsx("ul",{className:"list",children:l(Object.keys(t),1)},1)}const ee=new U(Y({langPrefix:"hljs language-",highlight(a,s,p){const c=C.getLanguage(s)?s:"plaintext";return C.highlight(a,{language:c}).value}}));function oe(){const{username:a,slug:s}=L(),p=F("root"),[c,l]=b.useState(!1),i=z(),{data:t,isLoading:h,isSuccess:r,isError:m,error:j,refetch:n}=v({queryKey:["getPost_"+i,a,s],queryFn:()=>M(a,s)}),u=v({queryKey:["getCommentsByPost_"+i,a,s],queryFn:()=>O(a,s)});b.useEffect(()=>{D(s,a).then(o=>{l(!!o)})},[s,a,i]);function R(){w(s,a,i).then(o=>{o?(l(!0),n()):l(!1)})}function N(){k(s,i).then(o=>{o?(l(!1),n()):l(!0)})}function E(o){o.preventDefault(),A(a,s,o.target[0].value,"").then(f=>{f&&(u.refetch(),o.target[0].value="")})}if(h)return e.jsx("div",{id:"blog-post",className:"centered-page",children:e.jsx(I,{sx:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0",margin:"auto"}})});if(m)return e.jsx("div",{id:"error-page",children:e.jsx("h1",{children:j.message})});if(r){document.title="byeAI | Post - "+t.title;const o={"@context":"https://schema.org","@type":"NewsArticle",headline:d.sanitize(t.title),image:[t.thumbnail],datePublished:d.sanitize(t.created_date),dateModified:d.sanitize(t.updated_date),author:[{"@type":"Person",name:d.sanitize(t.user.username),url:"/homepage/"+d.sanitize(t.user.username)}]};return e.jsxs(e.Fragment,{children:[e.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(o)}}),e.jsxs("div",{id:"blog-post",className:"text-based-page",children:[e.jsx("h1",{children:t.title}),e.jsxs("div",{className:"info-bar",children:[e.jsx("div",{className:"info-bar-box",children:e.jsx(Q,{content:t})}),e.jsx("button",{className:"reaction-button","data-testid":"reaction-button-icon",onClick:c?()=>N():()=>R(),children:e.jsxs("div",{className:"likes",children:[e.jsx("span",{"data-testid":"reaction-count",children:t.likes==null?0:t.likes}),c?e.jsx($,{}):e.jsx(S,{})]})}),e.jsxs("div",{id:"member-since",children:[e.jsx(G,{}),e.jsx("span",{children:t.created_date.replace(/(T.*)/g,"")})]}),e.jsx(q,{type:"post",isFlaggedParam:t.flagged,content:{username:t.user.username,slug:B(t.title)}}),p.username===a?e.jsx(g,{className:"text-box",to:i==="list"?y("f_EDIT_LIST",[i,s]):y("f_EDIT_BLOG_POST",["blog-post",s]),children:e.jsx("p",{children:"Edit"})}):null]}),t.crosspost!=null?e.jsxs("div",{className:"crosspost",children:[e.jsx("button",{children:e.jsx(g,{to:d.sanitize(t.crosspost.url),children:"Read the article"})}),e.jsxs("p",{children:["Hey! You! This is a crosspost! This button will take you to"," ",d.sanitize(t.crosspost.url),"."]})]}):null,e.jsx("div",{className:"blog-post-content-align-left",dangerouslySetInnerHTML:{__html:d.sanitize(ee.parse(t.content))}}),e.jsxs("div",{className:"comments",children:[e.jsx("h2",{children:"Comments"}),P()?e.jsxs("form",{onSubmit:f=>E(f),className:"create-comment-form",children:[e.jsx("textarea",{}),e.jsx("button",{type:"submit",children:"Comment"})]}):null,u.isSuccess?e.jsx(Z,{raw:u.data,refetch:u.refetch}):e.jsx("h3",{children:"There was an error fetching the comments!"})]})]})]})}}export{oe as P};
