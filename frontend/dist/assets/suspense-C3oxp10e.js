var at=s=>{throw TypeError(s)};var k=(s,t,i)=>t.has(s)||at("Cannot "+i);var e=(s,t,i)=>(k(s,t,"read from private field"),i?i.call(s):t.get(s)),l=(s,t,i)=>t.has(s)?at("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,i),n=(s,t,i,r)=>(k(s,t,"write to private field"),r?r.call(s,i):t.set(s,i),i),c=(s,t,i)=>(k(s,t,"access private method"),i);import{ad as bt,aE as R,ao as z,aF as A,aG as vt,aH as ht,aI as nt,aJ as mt,aK as gt,aL as Rt,aM as ot,ac as yt,r as L}from"./index-CTc59INo.js";import{s as Ct}from"./utils-km2FGkQ4.js";var f,a,D,d,E,Q,g,M,w,T,O,I,y,U,h,x,H,K,N,G,J,X,Y,dt,lt,Ut=(lt=class extends bt{constructor(t,i){super();l(this,h);l(this,f);l(this,a);l(this,D);l(this,d);l(this,E);l(this,Q);l(this,g);l(this,M);l(this,w);l(this,T);l(this,O);l(this,I);l(this,y);l(this,U,new Set);this.options=i,n(this,f,t),n(this,g,null),this.bindMethods(),this.setOptions(i)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(e(this,a).addObserver(this),ct(e(this,a),this.options)?c(this,h,x).call(this):this.updateResult(),c(this,h,G).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Z(e(this,a),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Z(e(this,a),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,c(this,h,J).call(this),c(this,h,X).call(this),e(this,a).removeObserver(this)}setOptions(t,i){const r=this.options,p=e(this,a);if(this.options=e(this,f).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof R(this.options.enabled,e(this,a))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");c(this,h,Y).call(this),e(this,a).setOptions(this.options),r._defaulted&&!z(this.options,r)&&e(this,f).getQueryCache().notify({type:"observerOptionsUpdated",query:e(this,a),observer:this});const u=this.hasListeners();u&&ut(e(this,a),p,this.options,r)&&c(this,h,x).call(this),this.updateResult(i),u&&(e(this,a)!==p||R(this.options.enabled,e(this,a))!==R(r.enabled,e(this,a))||A(this.options.staleTime,e(this,a))!==A(r.staleTime,e(this,a)))&&c(this,h,H).call(this);const m=c(this,h,K).call(this);u&&(e(this,a)!==p||R(this.options.enabled,e(this,a))!==R(r.enabled,e(this,a))||m!==e(this,y))&&c(this,h,N).call(this,m)}getOptimisticResult(t){const i=e(this,f).getQueryCache().build(e(this,f),t),r=this.createResult(i,t);return Et(this,r)&&(n(this,d,r),n(this,Q,this.options),n(this,E,e(this,a).state)),r}getCurrentResult(){return e(this,d)}trackResult(t,i){const r={};return Object.keys(t).forEach(p=>{Object.defineProperty(r,p,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(p),i==null||i(p),t[p])})}),r}trackProp(t){e(this,U).add(t)}getCurrentQuery(){return e(this,a)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const i=e(this,f).defaultQueryOptions(t),r=e(this,f).getQueryCache().build(e(this,f),i);return r.isFetchingOptimistic=!0,r.fetch().then(()=>this.createResult(r,i))}fetch(t){return c(this,h,x).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),e(this,d)))}createResult(t,i){var rt;const r=e(this,a),p=this.options,u=e(this,d),m=e(this,E),C=e(this,Q),P=t!==r?t.state:e(this,D),{state:F}=t;let o={...F},q=!1,v;if(i._optimisticResults){const b=this.hasListeners(),_=!b&&ct(t,i),pt=b&&ut(t,r,i,p);(_||pt)&&(o={...o,...Rt(F.data,t.options)}),i._optimisticResults==="isRestoring"&&(o.fetchStatus="idle")}let{error:tt,errorUpdatedAt:et,status:S}=o;if(i.select&&o.data!==void 0)if(u&&o.data===(m==null?void 0:m.data)&&i.select===e(this,M))v=e(this,w);else try{n(this,M,i.select),v=i.select(o.data),v=ot(u==null?void 0:u.data,v,i),n(this,w,v),n(this,g,null)}catch(b){n(this,g,b)}else v=o.data;if(i.placeholderData!==void 0&&v===void 0&&S==="pending"){let b;if(u!=null&&u.isPlaceholderData&&i.placeholderData===(C==null?void 0:C.placeholderData))b=u.data;else if(b=typeof i.placeholderData=="function"?i.placeholderData((rt=e(this,T))==null?void 0:rt.state.data,e(this,T)):i.placeholderData,i.select&&b!==void 0)try{b=i.select(b),n(this,g,null)}catch(_){n(this,g,_)}b!==void 0&&(S="success",v=ot(u==null?void 0:u.data,b,i),q=!0)}e(this,g)&&(tt=e(this,g),v=e(this,w),et=Date.now(),S="error");const j=o.fetchStatus==="fetching",V=S==="pending",W=S==="error",st=V&&j,it=v!==void 0;return{status:S,fetchStatus:o.fetchStatus,isPending:V,isSuccess:S==="success",isError:W,isInitialLoading:st,isLoading:st,data:v,dataUpdatedAt:o.dataUpdatedAt,error:tt,errorUpdatedAt:et,failureCount:o.fetchFailureCount,failureReason:o.fetchFailureReason,errorUpdateCount:o.errorUpdateCount,isFetched:o.dataUpdateCount>0||o.errorUpdateCount>0,isFetchedAfterMount:o.dataUpdateCount>P.dataUpdateCount||o.errorUpdateCount>P.errorUpdateCount,isFetching:j,isRefetching:j&&!V,isLoadingError:W&&!it,isPaused:o.fetchStatus==="paused",isPlaceholderData:q,isRefetchError:W&&it,isStale:$(t,i),refetch:this.refetch}}updateResult(t){const i=e(this,d),r=this.createResult(e(this,a),this.options);if(n(this,E,e(this,a).state),n(this,Q,this.options),e(this,E).data!==void 0&&n(this,T,e(this,a)),z(r,i))return;n(this,d,r);const p={},u=()=>{if(!i)return!0;const{notifyOnChangeProps:m}=this.options,C=typeof m=="function"?m():m;if(C==="all"||!C&&!e(this,U).size)return!0;const B=new Set(C??e(this,U));return this.options.throwOnError&&B.add("error"),Object.keys(e(this,d)).some(P=>{const F=P;return e(this,d)[F]!==i[F]&&B.has(F)})};(t==null?void 0:t.listeners)!==!1&&u()&&(p.listeners=!0),c(this,h,dt).call(this,{...p,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&c(this,h,G).call(this)}},f=new WeakMap,a=new WeakMap,D=new WeakMap,d=new WeakMap,E=new WeakMap,Q=new WeakMap,g=new WeakMap,M=new WeakMap,w=new WeakMap,T=new WeakMap,O=new WeakMap,I=new WeakMap,y=new WeakMap,U=new WeakMap,h=new WeakSet,x=function(t){c(this,h,Y).call(this);let i=e(this,a).fetch(this.options,t);return t!=null&&t.throwOnError||(i=i.catch(vt)),i},H=function(){c(this,h,J).call(this);const t=A(this.options.staleTime,e(this,a));if(ht||e(this,d).isStale||!nt(t))return;const r=mt(e(this,d).dataUpdatedAt,t)+1;n(this,O,setTimeout(()=>{e(this,d).isStale||this.updateResult()},r))},K=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(e(this,a)):this.options.refetchInterval)??!1},N=function(t){c(this,h,X).call(this),n(this,y,t),!(ht||R(this.options.enabled,e(this,a))===!1||!nt(e(this,y))||e(this,y)===0)&&n(this,I,setInterval(()=>{(this.options.refetchIntervalInBackground||gt.isFocused())&&c(this,h,x).call(this)},e(this,y)))},G=function(){c(this,h,H).call(this),c(this,h,N).call(this,c(this,h,K).call(this))},J=function(){e(this,O)&&(clearTimeout(e(this,O)),n(this,O,void 0))},X=function(){e(this,I)&&(clearInterval(e(this,I)),n(this,I,void 0))},Y=function(){const t=e(this,f).getQueryCache().build(e(this,f),this.options);if(t===e(this,a))return;const i=e(this,a);n(this,a,t),n(this,D,t.state),this.hasListeners()&&(i==null||i.removeObserver(this),t.addObserver(this))},dt=function(t){yt.batch(()=>{t.listeners&&this.listeners.forEach(i=>{i(e(this,d))}),e(this,f).getQueryCache().notify({query:e(this,a),type:"observerResultsUpdated"})})},lt);function St(s,t){return R(t.enabled,s)!==!1&&s.state.data===void 0&&!(s.state.status==="error"&&t.retryOnMount===!1)}function ct(s,t){return St(s,t)||s.state.data!==void 0&&Z(s,t,t.refetchOnMount)}function Z(s,t,i){if(R(t.enabled,s)!==!1){const r=typeof i=="function"?i(s):i;return r==="always"||r!==!1&&$(s,t)}return!1}function ut(s,t,i,r){return(s!==t||R(r.enabled,s)===!1)&&(!i.suspense||s.state.status!=="error")&&$(s,i)}function $(s,t){return R(t.enabled,s)!==!1&&s.isStaleByTime(A(t.staleTime,s))}function Et(s,t){return!z(s.getCurrentResult(),t)}var ft=L.createContext(!1),xt=()=>L.useContext(ft);ft.Provider;function Ot(){let s=!1;return{clearReset:()=>{s=!1},reset:()=>{s=!0},isReset:()=>s}}var It=L.createContext(Ot()),Dt=()=>L.useContext(It),Mt=(s,t)=>{(s.suspense||s.throwOnError)&&(t.isReset()||(s.retryOnMount=!1))},Lt=s=>{L.useEffect(()=>{s.clearReset()},[s])},Pt=({result:s,errorResetBoundary:t,throwOnError:i,query:r})=>s.isError&&!t.isReset()&&!s.isFetching&&r&&Ct(i,[s.error,r]),At=s=>{s.suspense&&(typeof s.staleTime!="number"&&(s.staleTime=1e3),typeof s.gcTime=="number"&&(s.gcTime=Math.max(s.gcTime,1e3)))},Bt=(s,t)=>s.isLoading&&s.isFetching&&!t,jt=(s,t)=>(s==null?void 0:s.suspense)&&t.isPending,Vt=(s,t,i)=>t.fetchOptimistic(s).catch(()=>{i.clearReset()});export{Ut as Q,Dt as a,Mt as b,Lt as c,At as e,Vt as f,Pt as g,jt as s,xt as u,Bt as w};
