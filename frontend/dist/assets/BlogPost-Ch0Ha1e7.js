import{t as x,j as e,U as S,J as F,r as p,n as C,ao as N,C as L,ap as M,X as E,s as B,L as q,aq as A,ar as D,as as I,at as w,au as T,av as O}from"./index-BFq9amJe.js";import{r as k,i as J}from"./createSvgIcon-D1jOfcbH.js";import{P as V,d as K}from"./Profile-DKl93URn.js";import{p as d}from"./purify.es-Bq0E5Q3l.js";import{M as Q,m as U,H as y}from"./index-qpdfNGLJ.js";import{C as _}from"./Comment-CHIOw7xi.js";import"./Close-ojBhIkc5.js";import"./Edit-Dnn69iIN.js";const X=x(e.jsx("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite"),$=x(e.jsx("path",{d:"M7 15v2h10v-2zm-4 6h18v-2H3zm0-8h18v-2H3zm4-6v2h10V7zM3 3v2h18V3z"}),"FormatAlignCenter"),G=x(e.jsx("path",{d:"M15 15H3v2h12zm0-8H3v2h12zM3 13h18v-2H3zm0 8h18v-2H3zM3 3v2h18V3z"}),"FormatAlignLeft");var j={},W=J;Object.defineProperty(j,"__esModule",{value:!0});var z=j.default=void 0,Y=W(k()),Z=e;z=j.default=(0,Y.default)((0,Z.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"}),"FavoriteBorder");function ee({raw:a,refetch:s}){const c=new Set([]);function l(t,h){return t.map(n=>{if(o[n]!=null&&c.has(n)==!1){const f=e.jsxs(e.Fragment,{children:[e.jsx(_,{content:r[n],isReply:h>1,refetch:s},r[n].id),l(Object.keys(o[n]),h+1)]});return c.add(n),f}return c.has(n)==!0?null:e.jsx(_,{content:r[n],isReply:h>1,refetch:s},r[n].id)})}const r={};a.forEach(t=>{r[t.id]=t});const o={},u=new Set([]);return a.forEach(t=>{t.reply_to!=null&&(o[t.reply_to.id]={...o[t.reply_to.id],[t.id]:null},u.add(t.id),u.add(t.reply_to.id))}),a.forEach(t=>{u.has(t.id)==!1&&(o[t.id]={})}),e.jsx("ul",{className:"list",children:l(Object.keys(o),1)},1)}const te=new Q(U({langPrefix:"hljs language-",highlight(a,s,c){const l=y.getLanguage(s)?s:"plaintext";return y.highlight(a,{language:l}).value}}));function de(){const{username:a,slug:s}=S(),c=F("root"),[l,r]=p.useState(!1),[o,u]=p.useState(!1),{data:t,isLoading:h,isSuccess:v,isError:n,error:f,refetch:b}=C({queryKey:["getBlogPost",a,s],queryFn:()=>T({username:a,slug:s})}),m=C({queryKey:["getCommentsByPost",s],queryFn:()=>O(a,s)});p.useEffect(()=>{N(s,a).then(i=>{r(!!i)})},[s,a]);function H(){D(s,a).then(i=>{i?(r(!0),b()):r(!1)})}function P(){I(s).then(i=>{i?(r(!1),b()):r(!0)})}function R(i){i.preventDefault(),w(s,i.target[0].value).then(g=>{g&&(m.refetch(),i.target[0].value="")})}if(h)return e.jsxs("div",{id:"blog-post",className:"centered-page",children:[e.jsx(L,{sx:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0",margin:"auto"}}),";"]});if(n)return e.jsx("div",{id:"error-page",children:e.jsx("h1",{children:f.message})});if(v){document.title=document.title+" - "+t.title;const i={"@context":"https://schema.org","@type":"NewsArticle",headline:d.sanitize(t.title),image:[t.thumbnail],datePublished:d.sanitize(t.created_date),dateModified:d.sanitize(t.updated_date),author:[{"@type":"Person",name:d.sanitize(t.user.username),url:"/homepage/"+d.sanitize(t.user.username)}]};return e.jsxs(e.Fragment,{children:[e.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(i)}}),e.jsxs("div",{id:"blog-post",children:[e.jsx("div",{className:"blogpost-thumbnail-wrapper",children:e.jsx(M,{url:t.thumbnail})}),e.jsx("h1",{children:t.title}),e.jsxs("div",{className:"info-bar",children:[e.jsx("div",{className:"info-bar-box",children:e.jsx(V,{content:t})}),e.jsx("button",{className:"reaction-button","data-testid":"reaction-button-icon",onClick:l?()=>P():()=>H(),children:e.jsxs("div",{className:"likes",children:[e.jsx("span",{"data-testid":"reaction-count",children:t.likes==null?0:t.likes}),l?e.jsx(X,{}):e.jsx(z,{})]})}),e.jsxs("div",{id:"member-since",children:[e.jsx(K,{}),e.jsx("span",{children:t.created_date.replace(/(T.*)/g,"")})]}),e.jsx("button",{className:"reaction-button",onClick:()=>u(!o),children:o?e.jsx($,{}):e.jsx(G,{})}),e.jsx(E,{type:"post",isFlaggedParam:t.flagged,content:{username:t.user.username,slug:B(t.title)}}),c.username===a?e.jsx(q,{className:"text-box",to:"/edit-post/"+s,children:e.jsx("p",{children:"Edit"})}):null]}),e.jsx("div",{className:o?"blog-post-content-align-left":"blog-post-content-align-center",dangerouslySetInnerHTML:{__html:d.sanitize(te.parse(t.content))}}),e.jsxs("div",{children:[e.jsx("h2",{children:"Comments"}),A()?e.jsxs("form",{onSubmit:g=>R(g),className:"create-comment-form",children:[e.jsx("textarea",{}),e.jsx("button",{type:"submit",children:"Comment"})]}):null,m.isSuccess?e.jsx(ee,{raw:m.data,refetch:m.refetch}):e.jsx("h3",{children:"There was an error fetching the comments!"})]})]})]})}}export{de as default};
