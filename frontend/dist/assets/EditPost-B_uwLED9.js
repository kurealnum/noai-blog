import{c as R,a1 as _,r as l,ae as F,af as h,at as N,T as w,e as H,aG as B,q as M,j as t,N as g,C as O,b as f,s as x,aH as G}from"./index-BX5Plg-3.js";import{S as U}from"./CreatePost-DLiSDZqa.js";import{p as b}from"./purify.es-Bq0E5Q3l.js";import{M as k,m as q,H as j}from"./index-ByFTUCV5.js";const D=new k(q({langPrefix:"hljs language-",highlight(i,a,n){const s=j.getLanguage(a)?a:"plaintext";return j.highlight(i,{language:s}).value}}));function Y(){const i=R("root"),{type:a,slug:n}=_(),[s,u]=l.useState({}),[d,P]=l.useState(""),[S,T]=l.useState({}),c=F();a==="list"?c(h(N)):a==="blog-post"&&c(h(w));const r=H({queryFn:()=>B(i.username,n),queryKey:["toEditBlogPost",{username:i.username,slug:n,type:a}],retry:!1}),o=M({mutationFn:G});l.useEffect(()=>{r.isSuccess&&(u({...r.data,slug:n}),r.data.crosspost!=null&&P(b.sanitize(r.data.crosspost.url)))},[n,r.data,r.isSuccess]);const v=1e3,y=l.useMemo(()=>({autosave:{enabled:!0,uniqueId:"autosaveeditedpost",delay:v},previewRender(e){return b.sanitize(D.parse(e))}}),[]);function E(e){e.preventDefault(),o.mutate({newBlogPost:s,thumbnail:S,originalSlug:n,crosspostURL:d})}function L(e){u({...s,content:e})}function m(e){u({...s,[e.target.name]:e.target.value})}function C(e){T({[e.target.name]:e.target.files[0]})}function p(){return d??""}if(r.isError)return t.jsx(g,{to:"/dashboard/"});if(r.isPending,o.isPending)return t.jsx(O,{sx:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0",margin:"auto"}});if(o.isSuccess){let e;return a==="list"?e=f("f_GET_LIST",[i.username,x(s.title)]):a==="blog-post"&&(e=f("f_GET_BLOG_POST",[i.username,x(s.title)])),t.jsx(g,{to:e})}return t.jsxs("div",{id:"create-post",children:[t.jsxs("form",{className:"post-form","aria-label":"Image and title input",encType:"multipart/form-data",method:"POST",onSubmit:e=>E(e),children:[t.jsxs("div",{className:"flex-row-spacing",children:[t.jsx("label",{htmlFor:"thumbnail",hidden:!0,children:"Thumbnail"}),t.jsx("input",{id:"thumbnail",name:"thumbnail",type:"file",accept:"image/png, image/jpeg",onChange:e=>C(e)}),p()!=""?t.jsxs(t.Fragment,{children:[t.jsx("label",{htmlFor:"url",hidden:!0,children:"URL for crosspost"}),t.jsx("input",{id:"url",name:"url",className:"generic-input",onChange:e=>m(e),defaultValue:p()})]}):null,t.jsx("label",{htmlFor:"title",hidden:!0,children:"Title"}),t.jsx("label",{htmlFor:"title",hidden:!0,children:"Title"}),t.jsx("input",{id:"title",name:"title",onChange:e=>m(e),defaultValue:s.title})]}),t.jsx("div",{className:"simplemde-wrapper",children:t.jsx(U,{options:y,onChange:L,value:s.content})}),t.jsx("button",{"data-testid":"submit-button",className:"save-button",type:"submit",children:"Save"})]}),o.isError?t.jsxs("div",{id:"error-page",children:[t.jsx("h1",{children:"There was an error!"}),t.jsx("p",{children:o.error.message})]}):null]})}export{Y as default};
